#!/bin/bash

IMAGE=${1}

# update
sudo apt-get -qq update > /dev/null
sudo apt-get -qq dist-upgrade > /dev/null

# install lxd
sudo apt-get -qq install lxd zfsutils-linux > /dev/null
sudo modprobe zfs

# initalize lxd
sudo lxd init --auto
truncate -s 20G lxd.img
sudo lxc --version
sudo lxc storage create default btrfs source=$(pwd)/lxd.img
sudo lxc profile device add default root disk path=/ pool=default

# restart lxd
sudo systemctl restart lxd

# debugging
sudo lxc profile show default

# launch lxd container
sudo lxc launch ${IMAGE} container
